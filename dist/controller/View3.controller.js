sap.ui.define(["sap/ui/core/mvc/Controller","de/varelmann/varelmann_scan_au/controller/Formatter","sap/m/MessageBox"],function(e,t,a){"use strict";return e.extend("de.varelmann.varelmann_scan_au.controller.View3",{_formFragments:{},onInit:function(){var e=this.getOwnerComponent().getModel("GLOBAL");this.getView().setModel(e,"global");this._showFormFragment("Nav1Change");var t=this.getOwnerComponent().getRouter();t.getRoute("View3").attachMatched(this._onRouteMatchedView3,this);var a=this;var r=this.getView().byId("initial_certificate");r.attachChange(function(e){a.value_changed(e,r)});var n=this.getView().byId("renewed_certificate");n.attachChange(function(e){a.value_changed(e,n)});var i=this.getView().byId("workplace_accident");i.attachChange(function(e){a.value_changed(e,i)});var o=this.getView().byId("doctor_assigned");o.attachChange(function(e){a.value_changed(e,o)});var c=this.getView().byId("incapacity_from");c.attachChange(function(e){a.value_changed(e,c)});var s=this.getView().byId("incapacity_to");s.attachChange(function(e){a.value_changed(e,s)});var g=this.getView().byId("incapacity_noticed");g.attachChange(function(e){a.value_changed(e,g)});this._showFormFragment("Nav1Display")},onNavOn:function(){var e=this.getOwnerComponent().getRouter();e.navTo("View3",{text:"View3"})},onNavBack:function(e){this.getOwnerComponent().getRouter().navTo("View1",{text:"View1"},false)},_onRouteMatchedView3:function(e){var t=this.getView().getModel("global");t.setProperty("/_w3_validated",true);t.setProperty("/_w3_back",true)},_getFormFragment:function(e){var t=this._formFragments[e];if(t){return t}t=sap.ui.xmlfragment(this.getView().getId(),"de.varelmann.varelmann_scan_au.view."+e);this._formFragments[e]=t;return this._formFragments[e]},_showFormFragment:function(e){var t=this.getView().byId("NAV1");t.removeAllContent();t.insertContent(this._getFormFragment(e))},onToggleChange:function(){var e=this.getView().getModel("global");var t=e.getProperty("/_w3_toggle");if(t){e.setProperty("/_w3_toggle",false);this._toggleButtonsAndView(false)}else{e.setProperty("/_w3_toggle",true);this._toggleButtonsAndView(true)}},_toggleButtonsAndView:function(e){var t=this.getView();t.byId("EDIT").setVisible(!e);t.byId("SAVE").setVisible(e);t.byId("BACK").setEnabled(!e);t.byId("FORW").setEnabled(!e);this._showFormFragment(e?"Nav1Change":"Nav1Display")},value_changed:function(e,t){var a=this.getView().getModel("global");var r=this.getView();var n=r.getModel("i18n").getResourceBundle().getText("manuell_changed");var i;switch(e.getParameter("id")){case"__xmlview2--initial_certificate":if(!a.getProperty("/_ocr_result/initial_certificate/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-initial_certificate")+" "+n;a.setProperty("/_ocr_result/initial_certificate/text",i);a.setProperty("/_ocr_result/initial_certificate/changed",true)}break;case"__xmlview2--renewed_certificate":if(!a.getProperty("/_ocr_result/renewed_certificate/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-renewed_certificate")+" "+n;a.setProperty("/_ocr_result/renewed_certificate/text",i);a.setProperty("/_ocr_result/renewed_certificate/changed",true)}break;case"__xmlview2--workplace_accident":if(!a.getProperty("/_ocr_result/workplace_accident/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-workplace_accident")+" "+n;a.setProperty("/_ocr_result/workplace_accident/text",i);a.setProperty("/_ocr_result/workplace_accident/changed",true)}break;case"__xmlview2--doctor_assigned":if(!a.getProperty("/_ocr_result/doctor_assigned/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-doctor_assigned")+" "+n;a.setProperty("/_ocr_result/doctor_assigned/text",i);a.setProperty("/_ocr_result/doctor_assigned/changed",true)}break;case"__xmlview2--incapacity_from":if(!a.getProperty("/_ocr_result/incapacity_from/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-incapacity_from")+" "+n;a.setProperty("/_ocr_result/incapacity_from/text",i);a.setProperty("/_ocr_result/incapacity_from/changed",true)}break;case"__xmlview2--incapacity_to":if(!a.getProperty("/_ocr_result/incapacity_to/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-incapacity_to")+" "+n;a.setProperty("/_ocr_result/incapacity_to/text",i);a.setProperty("/_ocr_result/incapacity_to/changed",true)}break;case"__xmlview2--incapacity_noticed":if(!a.getProperty("/_ocr_result/incapacity_noticed/changed")){i=r.getModel("i18n").getResourceBundle().getText("ocr_result-incapacity_noticed")+" "+n;a.setProperty("/_ocr_result/incapacity_noticed/text",i);a.setProperty("/_ocr_result/incapacity_noticed/changed",true)}break}},onMessagePress:function(e){this._getMessagePopover().openBy(e.getSource())},onClearPress:function(){sap.ui.getCore().getMessageManager().removeAllMessages()},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment(this.getView().getId(),"de.varelmann.varelmann_scan_au.view.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleRESTART:function(){this.getOwnerComponent().getRouter().navTo("View1",{text:"View1"},false)},handleUPLB:function(e){var t=!!this.getView().$().closest(".sapUiSizeCompact").length;var r=this.getView().getModel("i18n").getResourceBundle().getText("confirm__UPLB");var n=this.getView().getModel("i18n").getResourceBundle().getText("confirm_senden");var i=this;a.confirm(r,{actions:[n,sap.m.MessageBox.Action.CANCEL],styleClass:t?"sapUiSizeCompact":"",onClose:function(t){if(t==="Senden"){var r=i.create_UUID();var n=new Promise(function(t,a){i.getOwnerComponent().creating_data_backend(e,i,r,t,a)});n.then(function(t){switch(t){case"success":var n=new Promise(function(t,a){i.getOwnerComponent().creating_data_backend_pic(e,i,r,t,a)});n.then(function(e){switch(e){case"success":i.getView().setBusy(false);var t=i.getView().getModel("i18n").getResourceBundle().getText("succ_send");var r=!!i.getView().$().closest(".sapUiSizeCompact").length;a.success(t,{actions:[sap.m.MessageBox.Action.OK],styleClass:r?"sapUiSizeCompact":"",onClose:function(e){if(e==="OK"){i.handleRESTART();i.getRouter().navTo("View1",{text:"View1"},false)}}})}});break;case"reject":var o=i.getView().getModel("i18n").getResourceBundle().getText("erro_send");var c=!!i.getView().$().closest(".sapUiSizeCompact").length;a.error(o,{styleClass:c?"sapUiSizeCompact":""});i.getView().setBusy(false)}})}}})},create_UUID:function(){var e=(new Date).getTime();var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?a:a&3|8).toString(16)});return t}})});